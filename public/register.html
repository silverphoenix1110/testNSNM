<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta property="og:title" content="NhansuNhamay.com - Đăng ký nhận 1000 voucher Vexere và Grab" />
    <meta property="og:image" content="/img/Fb-share2.png" />
    <meta property="og:description" content="Nhân dịp lễ 2/9, NhansuNhamay.com xin dành tặng các bạn trong ngành sản xuất 1.000 voucher Vexere trị giá 100.000 VND khi đăng ký  tham gia chương trình, và tặng thêm code Grab 20.000 VND khi các bạn tiếp tục chia sẻ chương trình đến bạn bè. ">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Nhân Sự Nhà Máy - Đăng ký nhận 1000 voucher Vexere và Grab</title>

    <!-- Bootstrap core CSS -->
    <link href="css/vendors/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="css/vendors/mdb.min.css"/>
    <!--icon font css-->
    <link href="css/line-awesome.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/vendors/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/loading2.css" rel="stylesheet">
    <link href="css/microsite.css?20170822" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        /* Shared */
        .loginBtn {
            box-sizing: border-box;
            position: relative;
            /* width: 13em;  - apply for fixed size */
            margin: 0.2em;
            padding: 0 15px 0 46px;
            border: none;
            text-align: left;
            line-height: 34px;
            white-space: nowrap;
            border-radius: 0.2em;
            font-size: 16px;
            color: #FFF;
        }
        .loginBtn:before {
            content: "";
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            width: 34px;
            height: 100%;
        }
        .loginBtn:focus {
            outline: none;
        }
        .loginBtn:active {
            box-shadow: inset 0 0 0 32px rgba(0,0,0,0.1);
        }


        /* Facebook */
        .loginBtn--facebook {
            background-color: #4C69BA;
            background-image: linear-gradient(#4C69BA, #3B55A0);
            /*font-family: "Helvetica neue", Helvetica Neue, Helvetica, Arial, sans-serif;*/
            text-shadow: 0 -1px 0 #354C8C;
        }
        .loginBtn--facebook:before {
            border-right: #364e92 1px solid;
            background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/icon_facebook.png') 6px 6px no-repeat;
        }
        .loginBtn--facebook:hover,
        .loginBtn--facebook:focus {
            background-color: #5B7BD5;
            background-image: linear-gradient(#5B7BD5, #4864B1);
        }
    </style>
</head>
<body>
<script>
    console.log(navigator.userAgent)
    var userAgent = navigator.userAgent
    console.log(userAgent.indexOf(['iPhone OS 9']))
    if (userAgent.indexOf(['iPhone OS 9']) !== -1){
        window.location = "oops.html";
    }
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '193710201298406',
            cookie     : true,
            xfbml      : true,
            version    : 'v3.0'
        });
        FB.AppEvents.logPageView();
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container padding-b-10 padding-t-10">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <div class="col-xs-8 col-md-12">
                <a class="navbar-brand navHomeMenu" href="https://nhansunhamay.com">Nhân Sự Nhà Máy</a>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</nav>
<div class="site-wrapper">
    <div class="">
        <div class="container">
            <div id="loading_page" class="loading_page" style="display: none;">
                <div class="loading-view">
                    <div class="sk-circle">
                        <div class="sk-circle1 sk-child"></div>
                        <div class="sk-circle2 sk-child"></div>
                        <div class="sk-circle3 sk-child"></div>
                        <div class="sk-circle4 sk-child"></div>
                        <div class="sk-circle5 sk-child"></div>
                        <div class="sk-circle6 sk-child"></div>
                        <div class="sk-circle7 sk-child"></div>
                        <div class="sk-circle8 sk-child"></div>
                        <div class="sk-circle9 sk-child"></div>
                        <div class="sk-circle10 sk-child"></div>
                        <div class="sk-circle11 sk-child"></div>
                        <div class="sk-circle12 sk-child"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
                    <div class="steps-progress row text-center margin-b-30 margin-t-40">
                        <div class="steps-line">
                            <div class="steps-line-progress"></div>
                        </div>
                        <div class="steps-progress-st active col-xs-3" data-progress="0">
                            <div class="steps-progress-number steps-progress-icon">
                                <span><i class="la la-sign-in "></i></span>
                            </div>
                        </div>
                        <div class="steps-progress-st col-xs-3" data-progress="1">
                            <div class="steps-progress-number steps-progress-icon">
                                <span><i class="la la-building"></i></span>
                            </div>
                        </div>
                        <div class="steps-progress-st col-xs-3" data-progress="2">
                            <div class="steps-progress-number steps-progress-icon">
                                <span><i class="la la-user"></i></span>
                            </div>
                        </div>
                        <div class="steps-progress-st col-xs-3" data-progress="3">
                            <div class="steps-progress-number steps-progress-icon">
                                <span><i class="la la-share-alt-square"></i></span>
                            </div>
                        </div>
                    </div>
                    <!--Step 0-->
                    <div class="reg-steps" data-step="0">
                        <div class="row">
                            <div class="col-md-12 margin-b-15">
                                <p>Bạn hãy sử dụng tài khoản Facebook để đăng ký tham gia chương trình</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 margin-b-15 text-center">
                                <!-- <div class="fb-login-button"
                                    data-max-rows="1"
                                    data-size="large"
                                    data-button-type="continue_with"
                                    data-show-faces="false"
                                    data-auto-logout-link="false"
                                    data-use-continue-as="false"
                                    scope="public_profile,email"
                                    onlogin="checkLoginState();">
                                </div> -->

                                <button class="loginBtn loginBtn--facebook" id="loginFacebook">
                                    Login with Facebook
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- End Step 0 -->
                    <!-- <form id="form_register" enctype="multipart/form-data" action="/campaigns/completeRegistration" method="POST"> -->
                    <form id="form_register" enctype="multipart/form-data" action="#" method="POST">
                        <input type="hidden" value="" id="fb_id" name="fb_id"/>
                        <input type="hidden" value="" id="fb_name" name="fb_name"/>
                        <input type="hidden" value="" id="fb_email" name="fb_email"/>
                        <input type="hidden" value="" id="fb_avatar" name="fb_avatar"/>
                        <!--Step 1-->
                        <div class="reg-steps" data-step="1">
                            <div class="row">
                                <div class="col-md-12 margin-b-15">
                                    <p><strong>Để BTC xác thực bạn làm trong ngành sản xuất, bạn vui lòng cung cấp các thông tin sau:</strong></p>
                                </div>
                            </div>
                            <div id="form_step_1">
                                <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="company" name="company" type="text" class="validate form-control" required>
                                        <label for="company">Công ty</label>
                                    </div>
                                </div>
                                <!-- <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="hr_name" type="text" name="hr_name" class="validate form-control" required>
                                        <label for="hr_name">Họ tên trưởng phòng nhân sự</label>
                                        <p><small>(*) Trường hợp không biết trưởng phòng nhân sự, vui lòng cung cấp tên của một nhân viên của phòng nhân sự</small></p>
                                    </div>
                                </div> -->
                                <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="current_position" name="current_position" type="text" class="validate form-control" required>
                                        <label for="current_position">Vị trí đang công tác </label>
                                    </div>
                                </div>
                                <!-- <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="hr_phone" name="hr_phone" type="text" class="validate form-control" required>
                                        <label for="hr_phone">Số điện thoại phòng nhân sự</label>
                                    </div>
                                </div> -->
                                <div class="row">
                                    <div class="col-xs-9">
                                        <p>Upload hình ảnh bạn chụp cùng logo công ty (hoặc bảng tên công ty) hay cảnh bạn làm việc trong nhà máy. (Lưu ý phải có bạn trong hình)</p>
                                    </div>
                                    <div class="input-field col-xs-3 margin-t-0 text-right">
                                        <a type="button" class="btn-floating btn-small waves-effect waves-light">
                                            <i class="la la-file-image-o la-2x"></i>
                                            <input id="photo" type="file" name="photo" accept="image/*" required onchange="previewPhoto(event)" />
                                        </a>
                                    </div>
                                    <div class="col-xs-12 hidden">
                                        <img class="img-responsive" id="previewPhotoArea" src="" alt=""/>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <a class="btn btn-default btn-block btn-step" data-next="2">Tiếp tục <i class="la la-long-arrow-right"></i></a>
                                </div>
                            </div>
                        </div>
                        <!--End step 1-->
                        <!--Step 2-->
                        <div class="reg-steps" data-step="2">
                            <div id="form_step_2">
                                <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="full_name" name="full_name" type="text" class="validate form-control" required>
                                        <label for="full_name">Họ Tên</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="email" name="email" type="email" class="validate form-control" required>
                                        <label for="email">Email nhận voucher</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="input-field col-md-12">
                                        <input id="phone" name="phone" type="text" class="validate form-control" required>
                                        <label for="phone">Số điện thoại</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <!-- <a class="btn btn-default btn-block btn-step" data-next="3">Tiếp tục <i class="la la-long-arrow-right"></i></a> -->
                                    <button class="btn btn-default btn-block" id="register-button">Tiếp tục <i class="la la-long-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                        <!--End step 2-->
                    </form>
                    <!--Step 3-->
                    <div class="reg-steps" data-step="3">
                        <div class="row">
                            <div class="col-md-12">
                                <p>Cuối cùng, hãy<strong> nhấn nút copy để copy nội dung tô màu vàng sau đây. Sau đó đăng nội dung này lên Facebook ở chế độ Công khai</strong>. BTC sẽ kiểm tra post này và xét tính hợp lệ của chương trình. Nếu hợp lệ, BTC sẽ gửi Vexere Voucher qua email cho bạn. Chúc bạn may mắn.</p>
                            </div>
                            <div class="col-md-12 ">
                                <div class="bg-clipboard margin-t-15">
                                    <div id="text1">
                                        <p><span style="background: yellow" id="share_message">Mong thần may mắn giúp mình có 100K vé xe về quê ahihi</span></p>
                                        <p><span style="background: yellow" id="share_code">#NhansuNhamay #id</span></p>
                                        <p><span style="background: yellow">https://campaign29.nhansunhamay.com/</span></p>
                                    </div>
                                    <button type="button" class="btn btn-small btn-clipboard btn-link" data-clipboard-target="#text1" >Copy</button>
                                    <!--
                                    <div class="fb-share-button" data-href="https://campaign29.nhansunhamay.com/" data-layout="button_count" data-size="large" data-mobile-iframe="false">
                                        <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcampaign29.nhansunhamay.com%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Chia sẻ</a>
                                    </div>
                                    -->
                                </div>
                                <!-- <div class="bg-clipboard margin-t-15">
                                    <button type="button" class="btn btn-small btn-clipboard" data-clipboard-target="#text2" >Copy</button>
                                    <div id="text2">
                                        <p>Mong thần may mắn giúp mình có 100K vé xe về quê</p>
                                        <p>#nhansunhamay.com #id</p>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                        <div class="row margin-t-15">
                            <div class="col-md-12">
                                <a class="btn btn-default btn-block" data-toggle="modal" data-target="#complete">Hoàn tất</a>
                            </div>
                        </div>
                    </div>
                    <!--End step 3-->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-vertical" id="complete">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <p>Bạn đã copy nội dung bên dưới và post lên Facebook ở chế độ public chưa?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="declare_post_fb_btn">Rồi</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Chưa</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="alert_dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thông báo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="clearfix"></div>
<div class="footer section1">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="heading_name">Nhân Sự Nhà Máy</div>
                <div>
                    <i class="la la-map-marker la-1-8x"></i> TNR Tower, 180-192 Nguyen Cong Tru Str., Dist 1, Ho Chi Minh City, Vietnam.
                </div>
                <div>
                    <i class="la la-envelope la-1-8x"></i> <a href="mailto:love@nhansunhamay.com" title="contact">love@nhansunhamay.com</a>
                </div>
                <div>
                    <i class="la la-phone la-1-8x"></i> Ms. Thi - 0909 038 365
                </div>
                <!--
                <div>
                    <i class="la la-lock la-1-8x"></i><a href="">Quy định bảo mật</a> | <i class="la la-info-circle la-1-8x"></i><a href="">Thỏa thuận sử dụng</a>
                </div>
                -->
            </div>
            <div class="col-md-4 footer-copy">
                <em style="color: gray;">Copyright &copy;2018 NhansuNhamay.com. All rights reserved</em>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/mdb.min.js"></script>
<script src="js/ie10-viewport-bug-workaround.js"></script>
<script src="js/clipboard.min.js"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script> -->
<script src="js/firebase/firebase-app.js"></script>
<script src="js/firebase/firebase-auth.js"></script>
<script src="js/firebase/firebase-database.js"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script> -->
<script src="js/firebase/firebase-storage.js"></script>
<script>
    var config = {
        apiKey: "AIzaSyB7S9LgjUtkh8f9GFqbCGu2Rt1Glb5YCRU",
        authDomain: "nsnm-9355d.firebaseapp.com",
        databaseURL: "https://nsnm-9355d.firebaseio.com",
        projectId: "nsnm-9355d",
        storageBucket: "nsnm-9355d.appspot.com",
        messagingSenderId: "776480083991"
    };
    firebase.initializeApp(config);
    var firebaseUid = "";
    var user = "";
    $("#loginFacebook").click(function(){
        FB.login(function(response) {
            if (response.authResponse) {
                // access_token = response.authResponse.accessToken;
                $("#loading_page").show();
                // statusChangeCallback(response);
                // getUserFbInfo(response);
                var credential = firebase.auth.FacebookAuthProvider.credential(response.authResponse.accessToken);
                firebase.auth().signInAndRetrieveDataWithCredential(credential).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // The email of the user's account used.
                    var email = error.email;
                    // The firebase.auth.AuthCredential type that was used.
                    var credential = error.credential;
                    ("#alert_dialog").find('.modal-body').html('Bạn vui lòng refresh lại trang và đăng nhập bằng FB để tiếp tục')
                    $("#alert_dialog").modal('show');
                    $("#loading_page").hide();
                }).then(function(result) {
                    // This gives you a Facebook Access Token. You can use it to access the Facebook API.
                    var token = result.credential.accessToken;
                    // The signed-in user info.
                    user = result.user;
                    console.log(user)
                    if (!user) {
                        $("#alert_dialog").find('.modal-body').html('Bạn vui lòng refresh lại trang và đăng nhập bằng FB để tiếp tục')
                        $("#alert_dialog").modal('show');
                        $("#loading_page").hide();
                        return false;
                    }
                    firebaseUid = user.uid;
                    $('#fb_id').val(user.providerData[0].uid);
                    $('#fb_name').val(user.providerData[0].displayName);
                    $('#fb_email').val(user.providerData[0].email);
                    $('#fb_avatar').val(user.providerData[0].photoURL);
                    firebase.database().ref('/users/' + firebaseUid).once('value').then(function(snapshot) {
                        if (snapshot.val() && snapshot.val().email && snapshot.val().fb_email) {
                            if (user.providerData[0].email == snapshot.val().email || user.providerData[0].email == snapshot.val().fb_email) {
                                var creationTime = new Date(snapshot.val().created).toLocaleString('en-GB');
                                $("#alert_dialog").find('.modal-body').html('Bạn đã từng đăng ký tham gia chương trình này lúc '+creationTime+'. Do đó bạn không thể đăng ký thêm một lần nữa.')
                                $("#alert_dialog").modal({show:true});
                                $("#loading_page").hide();
                                return false;
                            }
                        }
                        $("#loading_page").hide();
                        goToNextStep(1);
                    });
                })
            } else {
                //user hit cancel button
                $("#alert_dialog").find('.modal-body').html('Bạn vui lòng đăng nhập bằng FB để tiếp tục')
                $("#alert_dialog").modal('show');
                $("#loading_page").hide();
            }
        }, {
            scope: 'public_profile,email'
        });
    })

    $("#declare_post_fb_btn").click(function(){
        var updates = {};
        updates['/users/' + firebaseUid + '/' + 'declare_post_fb'] = 1;
        firebase.database().ref().update(updates).then(function(){
            location.href="/"
        });
    });
    function previewPhoto(event){
        var file_path = URL.createObjectURL(event.target.files[0]);
        $("#previewPhotoArea").attr('src', file_path);
        $("#previewPhotoArea").parent().removeClass('hidden')
    }

    function validateEmail(email) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }
    function checkPhoneNumber(phone) {
        var flag = false;
        phone = phone.trim(); // ID của trường Số điện thoại
        phone = phone.replace('(+84)', '0');
        phone = phone.replace('+84', '0');
        phone = phone.replace('0084', '0');
        phone = phone.replace(/ /g, '');
        if (phone != '') {
            var firstNumber = phone.substring(0, 2);
            if ((firstNumber == '09' || firstNumber == '08') && phone.length == 10) {
                if (phone.match(/^\d{10}/)) {
                    flag = true;
                }
            } else if (firstNumber == '01' && phone.length == 11) {
                if (phone.match(/^\d{11}/)) {
                    flag = true;
                }
            }
        }
        return flag;
    }

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function goToNextStep(nextStep) {
        var activeStep = parseInt(nextStep) - 1;
        if (activeStep == 1) {
            var error = 0;
            $("#form_step_1").find('.error-block').remove();
            $("#form_step_1").find('input').each(function( i ) {
                if($(this).val()=='' && $(this).attr('name') != "hr_phone") {
                    $("<p class='error-block'>Bạn chưa hoàn tất mục này</p>").appendTo($(this).parents('.input-field'));
                    error++;
                }
            });
            if (error > 0) {
                return;
            }
        }
        if (activeStep == 2) {
            var error = 0;
            $("#form_step_2").find('.error-block').remove();
            $("#form_step_2").find('input').each(function( i ) {
                if($(this).val()=='') {
                    $("<p class='error-block'>Bạn chưa hoàn tất mục này</p>").appendTo($(this).parents('.input-field'));
                    error++;
                }
                if ($(this).attr('name') == "email") {
                    if (!validateEmail($(this).val())) {
                        $("<p class='error-block'>Email không hợp lệ. Bạn vui lòng kiểm tra lại</p>").appendTo($(this).parents('.input-field'));
                        error++;
                    }
                }
                if ($(this).attr('name') == "phone") {
                    if (!checkPhoneNumber($(this).val())) {
                        $("<p class='error-block'>Số điện thoại không hợp lệ. Bạn vui lòng kiểm tra lại</p>").appendTo($(this).parents('.input-field'));
                        error++;
                    }
                }
            });
            if (error > 0) {
                grecaptcha.reset(window.recaptchaWidgetId);
                return;
            }
            // $("#form_register").submit();
            // get form data
            var formdata = $("#form_register").serializeArray();
            var data = {};
            $(formdata ).each(function(index, obj){
                data[obj.name] = obj.value;
            });
            // upload photo file
            var ref = firebase.storage().ref();
            var file = $('#photo').get(0).files[0];
            var fileName = firebaseUid+'_'+file.name;
            var metadata = { contentType: file.type };
            $("#loading_page").show();
            firebase.database().ref('/users/' + firebaseUid).once('value').then(function(snapshot) {
                if (snapshot.val() && snapshot.val().email && snapshot.val().fb_email) {
                    if (user.providerData[0].email == snapshot.val().email || user.providerData[0].email == snapshot.val().fb_email) {
                        var creationTime = new Date(user.metadata.creationTime).toLocaleString('en-GB');
                        $("#alert_dialog").find('.modal-body').html('Bạn đã từng đăng ký tham gia chương trình này lúc '+creationTime+'. Do đó bạn không thể đăng ký thêm một lần nữa.')
                        $("#alert_dialog").modal({show:true});
                        $("#loading_page").hide();
                        return false;
                    }
                }
                var task = ref.child('vexere_campaign/photo/'+fileName).put(file, metadata);
                task.then(function(snapshot){snapshot.ref.getDownloadURL()})
                .then(function(url) {
                    var code = "NSNM"+firebaseUid;
                    data['identity_code'] = code;
                    data['photo'] = url;
                    data['valid_type'] = 0;
                    data['send_grab'] = 0;
                    data['declare_post_fb'] = 0;
                    data['shared_vexere_id_fb'] = 0;
                    data['shared_grab_id_fb'] = 0;
                    data['created'] = firebase.database.ServerValue.TIMESTAMP;
                    // save registration data
                    firebase.database().ref('users/' + firebaseUid).set(data).then(function(){
                        $("#share_code").html("#NhansuNhamay #"+code);
                        var share_message_arr = [
                            "Mong thần may mắn giúp mình có 120k vé xe đi chơi ahihi",
                            "Vào nhận voucher 120k đi du lịch hè với tui nè",
                            "Lâu rồi chưa đi xa, bon chen biết đâu lại may mắn có 120k voucher",
                            "Nhận ngay 120K voucher nè bà con ơi",
                            "Xách balo lên và đi thôi! Nhận voucher 100k Vexere thêm code Grab 20k nữa nè"
                        ];
                        var message_index = getRandomInt(0, share_message_arr.length-1);
                        var share_message = share_message_arr[message_index];
                        $("#share_message").html(share_message);
                        $("#loading_page").hide();
                    });
                })
            });
        }
        // return;

        // console.log(activeStep); return;
        var widthLine = '';
        if (nextStep == 1) {
            widthLine = 100 / 4 / 2 + 100/4 + '%'
        } else if (nextStep == 2) {
            widthLine = 100 / 4 / 2 + 100/2 + '%'
        } else if (nextStep == 3) {
            widthLine = '100%'
        }
        $('.reg-steps[data-step='+ activeStep +']').hide();
        $('.reg-steps[data-step='+ nextStep +']').show();
        $('.steps-line-progress').css({
            'width' : widthLine
        })
        $('.steps-progress-st[data-progress='+ nextStep +']').addClass('active');
        $('.steps-progress-st[data-progress='+ activeStep +']').addClass('activated').removeClass('active');
    }

    $(document).ready(function(){
        firebase.auth().useDeviceLanguage();
        // recaptcha
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('register-button', {
            'size': 'invisible',
            'callback': function(response) {
                console.log(response)
                // reCAPTCHA solved, allow signInWithPhoneNumber.
                goToNextStep(3);
            }
        });
        recaptchaVerifier.render().then(function(widgetId) {
            window.recaptchaWidgetId = widgetId;
        });

        var win_h = $(window).height(),
                foot_h = $('.footer').outerHeight(),
                nav_h = $('nav').outerHeight();
        $('.site-wrapper').outerHeight(win_h - foot_h - nav_h - 50).css({
            'margin-top': nav_h - 50
        });

        $(window).resize(function(){
            var win_h = $(window).height(),
                    foot_h = $('.footer').outerHeight(),
                    nav_h = $('nav').outerHeight();
            $('.site-wrapper').outerHeight(win_h - foot_h - nav_h - 50).css({
                'margin-top': nav_h - 50
            });
        })

        $('.reg-steps').each(function(){
            $(this).hide();
            $('.reg-steps[data-step=0]').show();
            $('.steps-line-progress').css({
                'width' : 100 / 4 / 2 +'%'
            })
        });

        $('.btn-step').each(function(){
            $(this).on('click', function(){
                var nextStep = $(this).data('next');
                goToNextStep(nextStep)
            })
        })

        // var file_path = URL.createObjectURL(event.target.files[0]);
        $('.btn-clipboard').tooltip({
            trigger: 'click',
            placement: 'top'
        });

        function setTooltip(btn, message) {
            btn.tooltip('hide')
                    .attr('data-original-title', message)
                    .tooltip('show');
        }

        function hideTooltip(btn) {
            setTimeout(function() {
                btn.tooltip('hide');
            }, 1000);
        }

        // Clipboard

        var clipboard = new ClipboardJS('.btn-clipboard');

        clipboard.on('success', function(e) {
            var btn = $(e.trigger);
            setTooltip(btn,'Copied!');
            hideTooltip(btn);
            e.clearSelection();
        });

        clipboard.on('error', function(e) {
            var btn = $(e.trigger);
            setTooltip(btn,'Failed!');
            hideTooltip(btn);
            e.clearSelection();
        });
    })
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-105678552-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-105678552-2');
</script>
<!-- Hotjar Tracking Code for https://campaign29.nhansunhamay.com/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:982786,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</body>
</html>
